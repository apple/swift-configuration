# SCO-0004: Add PropertyListSnapshot provider

Add support for property list (plist) configuration files.

## Overview

- Proposal: SCO-0004
- Author(s): [Manoj Mahapatra](https://github.com/manojmahapatra)
- Status: **Awaiting Review**
- Issue: [apple/swift-configuration#153](https://github.com/apple/swift-configuration/issues/153)
- Implementation:
    - [apple/swift-configuration#155](https://github.com/apple/swift-configuration/pull/155)

### Introduction

Add a `PropertyListSnapshot` type that implements `FileConfigSnapshot` to enable reading configuration from property list files.

### Motivation

Property lists are a native configuration format on Apple platforms, widely used in iOS, macOS, tvOS, and watchOS applications. Many Apple platform developers already have configuration stored in plist files (Info.plist, Settings bundles, etc.) and would benefit from using swift-configuration with their existing format.

Currently, adopters must either:
- Convert existing plist configuration to JSON or YAML
- Implement their own plist provider
- Use a separate configuration loading mechanism for plist files

### Proposed solution

Add a `PropertyListSnapshot` type behind a `PropertyList` trait, following the same pattern as `YAMLSnapshot`:

```swift
// Enable via trait in Package.swift
.product(name: "Configuration", package: "swift-configuration", traits: ["PropertyList"])
```

```swift
import Configuration

let provider = try await FileProvider<PropertyListSnapshot>(filePath: "Config.plist")
let config = ConfigReader(provider: provider)

let timeout = config.int(forKey: "http.timeout", default: 30)
```

Example plist file:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>http</key>
    <dict>
        <key>timeout</key>
        <integer>30</integer>
    </dict>
</dict>
</plist>
```

Both XML and binary plist formats are supported, as `PropertyListSerialization` auto-detects the format.

### Detailed design

#### New types

```swift
/// A snapshot of configuration values parsed from a property list file.
///
/// This structure represents a point-in-time view of configuration values. It handles
/// the conversion from property list types to configuration value types.
///
/// Commonly used with ``FileProvider`` and ``ReloadingFileProvider``.
public struct PropertyListSnapshot: FileConfigSnapshot {
    /// Parsing options for property list snapshot creation.
    ///
    /// This struct provides configuration options for parsing property list data into configuration snapshots    
    public struct ParsingOptions: FileParsingOptions {        
        /// A specifier for determining which configuration values should be treated as secrets.
        public var secretsSpecifier: SecretsSpecifier<String, any Sendable>
        
        /// Creates parsing options for property list snapshots.
        ///
        /// - Parameters:        
        ///   - secretsSpecifier: The specifier for identifying secret values.
        public init(            
            secretsSpecifier: SecretsSpecifier<String, any Sendable> = .none
        )
        
        /// The default parsing options.
        ///
        /// Uses base64 byte decoding and treats no values as secrets.
        public static var `default`: Self
    }
    
    /// The name of the provider that created this snapshot.
    public let providerName: String
}

extension PropertyListSnapshot: FileConfigSnapshot {
    public init(
        data: RawSpan, 
        providerName: String, 
        parsingOptions: ParsingOptions
    ) throws
}

extension PropertyListSnapshot: ConfigSnapshot {
    public func value(
        forKey key: AbsoluteConfigKey, 
        type: ConfigType
    ) throws -> LookupResult
}

extension PropertyListSnapshot: CustomStringConvertible {
    public var description: String
}

extension PropertyListSnapshot: CustomDebugStringConvertible {
    public var debugDescription: String
}
```

#### Supported types

| Plist type | Swift type | ConfigReader method |
|------------|------------|---------------------|
| `<string>` | String | `string(forKey:)` |
| `<integer>` | Int | `int(forKey:)` |
| `<real>` | Double | `double(forKey:)` |
| `<true/>`/`<false/>` | Bool | `bool(forKey:)` |
| `<data>` | Data | `bytes(forKey:)` |
| `<array>` | [T] | `strings(forKey:)`, etc. |
| `<dict>` | nested | Flattened with dot notation |

#### Trait definition

```swift
.trait(
    name: "PropertyList",
    description: "Adds support for parsing property list configuration files."
)
```

### API stability

This change is purely additive. No existing adopters are affected.

### Future directions

Nothing comes to mind at the moment.

### Alternatives considered

- **Use JSON or YAML instead**: Requires adopters to convert existing plist configuration, adding friction for Apple platform developers.
