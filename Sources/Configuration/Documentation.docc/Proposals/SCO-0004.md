# SCO-0004: Add PlistSnapshot provider

Add support for property list (plist) configuration files.

## Overview

- Proposal: SCO-0004
- Author(s): [Manoj Mahapatra](https://github.com/manojmahapatra)
- Status: **Awaiting Review**
- Issue: [apple/swift-configuration#153](https://github.com/apple/swift-configuration/issues/153)
- Implementation:
    - [apple/swift-configuration#XXX](https://github.com/apple/swift-configuration/pull/XXX)

### Introduction

Add a `PlistSnapshot` type that implements `FileConfigSnapshot` to enable reading configuration from property list files.

### Motivation

Property lists are a native configuration format on Apple platforms, widely used in iOS, macOS, tvOS, and watchOS applications. Many Apple platform developers already have configuration stored in plist files (Info.plist, Settings bundles, etc.) and would benefit from using swift-configuration with their existing format.

Currently, adopters must either:
- Convert existing plist configuration to JSON or YAML
- Implement their own plist provider
- Use a separate configuration loading mechanism for plist files

### Proposed solution

Add a `PlistSnapshot` type behind a `Plist` trait, following the same pattern as `YAMLSnapshot`:

```swift
// Enable via trait in Package.swift
.product(name: "Configuration", package: "swift-configuration", traits: ["Plist"])
```

```swift
import Configuration

let provider = try await FileProvider<PlistSnapshot>(filePath: "Config.plist")
let config = ConfigReader(provider: provider)

let timeout = config.int(forKey: "http.timeout", default: 30)
```

Example plist file:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>http</key>
    <dict>
        <key>timeout</key>
        <integer>30</integer>
    </dict>
</dict>
</plist>
```

Key benefits:
- Native `<data>` type supportâ€”no base64 encoding needed for binary configuration values
- Consistent with existing JSON and YAML snapshot patterns
- Uses Foundation's `PropertyListSerialization`, available on all Swift platforms

### Detailed design

#### New types

```swift
/// A snapshot of configuration values parsed from a property list file.
public struct PlistSnapshot: FileConfigSnapshot {
    public struct ParsingOptions: FileParsingOptions {
        /// A decoder of bytes from a string.
        public var bytesDecoder: any ConfigBytesFromStringDecoder
        
        /// A specifier for determining which configuration values should be treated as secrets.
        public var secretsSpecifier: SecretsSpecifier<String, any Sendable>
        
        public init(
            bytesDecoder: some ConfigBytesFromStringDecoder = .base64,
            secretsSpecifier: SecretsSpecifier<String, any Sendable> = .none
        )
        
        public static var `default`: Self { .init() }
    }
}
```

#### Supported types

| Plist type | Swift type | ConfigReader method |
|------------|------------|---------------------|
| `<string>` | String | `string(forKey:)` |
| `<integer>` | Int | `int(forKey:)` |
| `<real>` | Double | `double(forKey:)` |
| `<true/>`/`<false/>` | Bool | `bool(forKey:)` |
| `<data>` | Data | `bytes(forKey:)` |
| `<array>` | [T] | `strings(forKey:)`, etc. |
| `<dict>` | nested | Flattened with dot notation |

#### Trait definition

```swift
.trait(
    name: "Plist",
    description: "Adds support for parsing property list configuration files."
)
```

#### Implementation notes

- Uses `PropertyListSerialization.propertyList(from:options:format:)` for parsing
- Nested dictionaries are flattened using dot notation (e.g., `http.timeout`)
- Binary `<data>` values are returned directly without base64 decoding, unlike JSON where bytes must be base64-encoded strings

### API stability

This change is purely additive. No existing adopters are affected.

### Future directions

Nothing comes to mind at the moment.

### Alternatives considered

- **Use JSON or YAML instead**: Requires adopters to convert existing plist configuration, adding friction for Apple platform developers.
