//===----------------------------------------------------------------------===//
//
// This source file is part of the SwiftConfiguration open source project
//
// Copyright (c) 2025 Apple Inc. and the SwiftConfiguration project authors
// Licensed under Apache License v2.0
//
// See LICENSE.txt for license information
// See CONTRIBUTORS.txt for the list of SwiftConfiguration project authors
//
// SPDX-License-Identifier: Apache-2.0
//
//===----------------------------------------------------------------------===//

// License header will go here

// #############################################################################
// #                                                                           #
// #            DO NOT EDIT THIS FILE; IT IS AUTOGENERATED.                    #
// #                                                                           #
// #############################################################################

import Testing
@testable import Configuration
import ConfigurationTestingInternal

struct ConfigReaderMethodTestsWatch3 {

    typealias Defaults = ConfigReaderTests.Defaults
    typealias TestEnum = ConfigReaderTests.TestEnum
    typealias TestStringConvertible = ConfigReaderTests.TestStringConvertible

    @available(Configuration 1.0, *)
    @Test func watch() async throws {
        let config = ConfigReaderTests.config

        do {
            // Optional - success
            #expect(
                try await config.watchStringArray(
                    forKey: ConfigKey(["stringConvertibleArray"]),
                    as: TestStringConvertible.self,
                    updatesHandler: awaitFirst
                ) == Defaults.stringConvertibleArray
            )
            #expect(
                try await config.watchStringArray(
                    forKey: "stringConvertibleArray",
                    as: TestStringConvertible.self,
                    updatesHandler: awaitFirst
                ) == Defaults.stringConvertibleArray
            )

            // Optional - missing
            #expect(
                try await config.watchStringArray(
                    forKey: ConfigKey(["absentStringConvertibleArray"]),
                    as: TestStringConvertible.self,
                    updatesHandler: awaitFirst
                ) == .some(nil)
            )
            #expect(
                try await config.watchStringArray(
                    forKey: "absentStringConvertibleArray",
                    as: TestStringConvertible.self,
                    updatesHandler: awaitFirst
                ) == .some(nil)
            )

            // Optional - failing
            #expect(
                try await config.watchStringArray(
                    forKey: ConfigKey(["failure"]),
                    as: TestStringConvertible.self,
                    updatesHandler: awaitFirst
                ) == .some(nil)
            )
            #expect(
                try await config.watchStringArray(
                    forKey: "failure",
                    as: TestStringConvertible.self,
                    updatesHandler: awaitFirst
                ) == .some(nil)
            )

            // Defaulted - success
            #expect(
                try await config.watchStringArray(
                    forKey: ConfigKey(["stringConvertibleArray"]),
                    as: TestStringConvertible.self,
                    default: Defaults.otherStringConvertibleArray,
                    updatesHandler: awaitFirst
                ) == Defaults.stringConvertibleArray
            )
            #expect(
                try await config.watchStringArray(
                    forKey: "stringConvertibleArray",
                    as: TestStringConvertible.self,
                    default: Defaults.otherStringConvertibleArray,
                    updatesHandler: awaitFirst
                ) == Defaults.stringConvertibleArray
            )

            // Defaulted - missing
            #expect(
                try await config.watchStringArray(
                    forKey: ConfigKey(["absentStringConvertibleArray"]),
                    as: TestStringConvertible.self,
                    default: Defaults.otherStringConvertibleArray,
                    updatesHandler: awaitFirst
                ) == Defaults.otherStringConvertibleArray
            )
            #expect(
                try await config.watchStringArray(
                    forKey: "absentStringConvertibleArray",
                    as: TestStringConvertible.self,
                    default: Defaults.otherStringConvertibleArray,
                    updatesHandler: awaitFirst
                ) == Defaults.otherStringConvertibleArray
            )

            // Defaulted - failing
            #expect(
                try await config.watchStringArray(
                    forKey: ConfigKey(["failure"]),
                    as: TestStringConvertible.self,
                    default: Defaults.otherStringConvertibleArray,
                    updatesHandler: awaitFirst
                ) == Defaults.otherStringConvertibleArray
            )
            #expect(
                try await config.watchStringArray(
                    forKey: "failure",
                    as: TestStringConvertible.self,
                    default: Defaults.otherStringConvertibleArray,
                    updatesHandler: awaitFirst
                ) == Defaults.otherStringConvertibleArray
            )

            // Required - success
            #expect(
                try await config.watchRequiredStringArray(
                    forKey: ConfigKey(["stringConvertibleArray"]),
                    as: TestStringConvertible.self,
                    updatesHandler: awaitFirst
                ) == Defaults.stringConvertibleArray
            )
            #expect(
                try await config.watchRequiredStringArray(
                    forKey: "stringConvertibleArray",
                    as: TestStringConvertible.self,
                    updatesHandler: awaitFirst
                ) == Defaults.stringConvertibleArray
            )

            // Required - missing
            let error1 = await #expect(throws: ConfigError.self) {
                try await config.watchRequiredStringArray(
                    forKey: ConfigKey(["absentStringConvertibleArray"]),
                    as: TestStringConvertible.self,
                    updatesHandler: awaitFirst
                )
            }
            #expect(error1 == .missingRequiredConfigValue(AbsoluteConfigKey(["absentStringConvertibleArray"])))
            let error2 = await #expect(throws: ConfigError.self) {
                try await config.watchRequiredStringArray(
                    forKey: "absentStringConvertibleArray",
                    as: TestStringConvertible.self,
                    updatesHandler: awaitFirst
                )
            }
            #expect(error2 == .missingRequiredConfigValue(AbsoluteConfigKey(["absentStringConvertibleArray"])))

            // Required - failing
            await #expect(throws: TestProvider.TestError.self) {
                try await config.watchRequiredStringArray(
                    forKey: ConfigKey(["failure"]),
                    as: TestStringConvertible.self,
                    updatesHandler: awaitFirst
                )
            }
            await #expect(throws: TestProvider.TestError.self) {
                try await config.watchRequiredStringArray(
                    forKey: "failure",
                    as: TestStringConvertible.self,
                    updatesHandler: awaitFirst
                )
            }
        }
        do {
            // Optional - success
            #expect(
                try await config.watchStringArray(
                    forKey: ConfigKey(["stringEnumArray"]),
                    as: TestEnum.self,
                    updatesHandler: awaitFirst
                ) == Defaults.stringEnumArray
            )
            #expect(
                try await config.watchStringArray(
                    forKey: "stringEnumArray",
                    as: TestEnum.self,
                    updatesHandler: awaitFirst
                ) == Defaults.stringEnumArray
            )

            // Optional - missing
            #expect(
                try await config.watchStringArray(
                    forKey: ConfigKey(["absentStringEnumArray"]),
                    as: TestEnum.self,
                    updatesHandler: awaitFirst
                ) == .some(nil)
            )
            #expect(
                try await config.watchStringArray(
                    forKey: "absentStringEnumArray",
                    as: TestEnum.self,
                    updatesHandler: awaitFirst
                ) == .some(nil)
            )

            // Optional - failing
            #expect(
                try await config.watchStringArray(
                    forKey: ConfigKey(["failure"]),
                    as: TestEnum.self,
                    updatesHandler: awaitFirst
                ) == .some(nil)
            )
            #expect(
                try await config.watchStringArray(forKey: "failure", as: TestEnum.self, updatesHandler: awaitFirst)
                    == .some(nil)
            )

            // Defaulted - success
            #expect(
                try await config.watchStringArray(
                    forKey: ConfigKey(["stringEnumArray"]),
                    as: TestEnum.self,
                    default: Defaults.otherStringEnumArray,
                    updatesHandler: awaitFirst
                ) == Defaults.stringEnumArray
            )
            #expect(
                try await config.watchStringArray(
                    forKey: "stringEnumArray",
                    as: TestEnum.self,
                    default: Defaults.otherStringEnumArray,
                    updatesHandler: awaitFirst
                ) == Defaults.stringEnumArray
            )

            // Defaulted - missing
            #expect(
                try await config.watchStringArray(
                    forKey: ConfigKey(["absentStringEnumArray"]),
                    as: TestEnum.self,
                    default: Defaults.otherStringEnumArray,
                    updatesHandler: awaitFirst
                ) == Defaults.otherStringEnumArray
            )
            #expect(
                try await config.watchStringArray(
                    forKey: "absentStringEnumArray",
                    as: TestEnum.self,
                    default: Defaults.otherStringEnumArray,
                    updatesHandler: awaitFirst
                ) == Defaults.otherStringEnumArray
            )

            // Defaulted - failing
            #expect(
                try await config.watchStringArray(
                    forKey: ConfigKey(["failure"]),
                    as: TestEnum.self,
                    default: Defaults.otherStringEnumArray,
                    updatesHandler: awaitFirst
                ) == Defaults.otherStringEnumArray
            )
            #expect(
                try await config.watchStringArray(
                    forKey: "failure",
                    as: TestEnum.self,
                    default: Defaults.otherStringEnumArray,
                    updatesHandler: awaitFirst
                ) == Defaults.otherStringEnumArray
            )

            // Required - success
            #expect(
                try await config.watchRequiredStringArray(
                    forKey: ConfigKey(["stringEnumArray"]),
                    as: TestEnum.self,
                    updatesHandler: awaitFirst
                ) == Defaults.stringEnumArray
            )
            #expect(
                try await config.watchRequiredStringArray(
                    forKey: "stringEnumArray",
                    as: TestEnum.self,
                    updatesHandler: awaitFirst
                ) == Defaults.stringEnumArray
            )

            // Required - missing
            let error1 = await #expect(throws: ConfigError.self) {
                try await config.watchRequiredStringArray(
                    forKey: ConfigKey(["absentStringEnumArray"]),
                    as: TestEnum.self,
                    updatesHandler: awaitFirst
                )
            }
            #expect(error1 == .missingRequiredConfigValue(AbsoluteConfigKey(["absentStringEnumArray"])))
            let error2 = await #expect(throws: ConfigError.self) {
                try await config.watchRequiredStringArray(
                    forKey: "absentStringEnumArray",
                    as: TestEnum.self,
                    updatesHandler: awaitFirst
                )
            }
            #expect(error2 == .missingRequiredConfigValue(AbsoluteConfigKey(["absentStringEnumArray"])))

            // Required - failing
            await #expect(throws: TestProvider.TestError.self) {
                try await config.watchRequiredStringArray(
                    forKey: ConfigKey(["failure"]),
                    as: TestEnum.self,
                    updatesHandler: awaitFirst
                )
            }
            await #expect(throws: TestProvider.TestError.self) {
                try await config.watchRequiredStringArray(
                    forKey: "failure",
                    as: TestEnum.self,
                    updatesHandler: awaitFirst
                )
            }
        }
    }
}
